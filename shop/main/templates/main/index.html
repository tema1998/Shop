{% extends 'main/base.html' %}
{% block title %}j-Shop - Интернет-магазин техники{% endblock %}

{% block content %}
    <section class="py-5">
        <div class="container-products">

            {% for product in products %}

                <div class="card-product">

                    <div class="product-image">
                        {% if product.stock == 0 %}
                            <img class="img-size-control img-for-no-product" src="{{ product.image.url }}" alt="..." />
                        {% else %}
                            <img class="img-size-control" src="{{ product.image.url }}" alt="..." />
                        {% endif %}
                    </div>

                    <div class="product-text">
                        <a href="{{ product.get_absolute_url }}">{{ product.name}}</a>
                    </div>

                    <div class="product-rating">
                        РЕЙТИНГ
                    </div>


                    <div class="product-prices">
                        {% if product.price_with_discount == 0 %}
                            <div class="product-price"> {{ product.price }} </div>
                        {% else %}
                            <div class="product-new-price"> {{ product.price_with_discount }} </div>
                            <div class="product-old-price"> {{ product.price }} </div>
                        {% endif %}
                    </div>

                    <div class="product-button">
                        {% if product.stock == 0 %}
                            <div class="text-center"><a class="btn btn-outline-dark mt-auto deactivate-url" href="#">Товар закончился</a></div>
                        {% else %}
                            <form action="" method="POST" enctype="multipart/form-data">
                                {% csrf_token %}
                                <input type="hidden" name="product_id" value="{{ product.id }}">
                                <div class="text-center">
                                <button type="submit" class="btn btn-outline-dark mt-auto"> Добавить в корзину </button>
                                </div>
                            </form>
                        {% endif %}
                    </div>

                </div>

            {% endfor %}



        </div>

    <div class="pagination-block">
        <div class="pagination">

            {% if products.has_previous %}
                <a href="?page={{ products.number|add:-1 }}">«</a>
            {% endif %}

            {% if products.number|add:-2 > 1 %}
                <a href="?page=1"> 1 </a>
                <a class="deactivate-url" href=""> ... </a>
            {% endif %}

            {% for page in products.paginator.page_range %}
                {% if page == products.number %}
                    <a class="active" href="?page={{ page }}"> {{ page }} </a>
                {% elif page >= products.number|add:-2 and page <= products.number|add:2 %}
                    <a href="?page={{ page }}"> {{ page }} </a>
                {% endif %}
            {% endfor %}

            {% if products.number|add:2 < products.paginator.num_pages %}
                <a class="deactivate-url" href=""> ... </a>
                <a href="?page={{ products.paginator.num_pages }}"> {{ products.paginator.num_pages }} </a>
            {% endif %}

            {% if products.has_next %}
            <a href="?page={{ products.number|add:1 }}">»</a>
            {% endif %}

        </div>
    </div>

    </section>



{% endblock %}